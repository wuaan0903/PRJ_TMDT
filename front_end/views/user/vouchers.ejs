<%- layout('../layouts/index') %>

<style>
    /* định dạng Header */
     .custom-header {
                background: #fff;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                padding: 20px;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
        /* Tăng kích thước icon */
        .custom-header i {
            font-size: 24px;
            color: #fbc02d; /* Màu vàng giống vương miện */
        }
    /* Sidebar */
    .sidebar {
        background: #d9d9d9;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        height: fit-content;
    }

    .list-group-item {
        
        font-size: 16px;
        padding: 12px 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #333;
        transition: all 0.3s ease-in-out;
        text-decoration: none;
        border-radius: 8px;
        background: #fff;
        
    }

    .list-group-item i {
        font-size: 18px;
    }

    /* Hover */
    .list-group-item:hover {
        background: #000;
        color: #fff !important;
        transform: translateY(-3px);
    }

    /* Active */
    .list-group-item.active {
        background: #000 !important;
        color: #fff !important;
    }

    /* Logout - Đăng xuất */
    .list-group-item.text-danger {
        font-weight: bold;
    }

    /* Hover riêng cho Đăng xuất */
    .list-group-item.text-danger:hover {
        background: #dc3545 !important;
        color: #fff !important;
    }

    .voucher-card {
        background: #f1f1f1;
        border-radius: 10px;
        padding: 15px;
        position: relative;
        transition: all 0.2s ease-in-out;
    }
    .voucher-card:hover{
        background: #bdbdbd;
    }
    .voucher-card::before{
        content: "";
        position: absolute;
        top: 50%;
        width: 15px;
        height: 20px;
        background: #d9d9d9;
        border-radius: 50%;
        transform: translateY(-50%);
    }
    .voucher-card::before { left: -5px; }
</style>

<!-- Bootstrap Grid Layout -->
<div class="container pt-5" style="
margin: 0;
margin-top: 60px;
max-width: 100%;
padding: 0 50px;
">
    <div class="row">
        <ul class="side-menu top">
        <div class="custom-header ">
            <!-- Bên trái -->
            <div class="left">
                <h4>Hi, <span class="fw-bold">Cấp Nguyễn</span> <i class='bx bx-crown' ></i></h4>
        </div>
        </ul>
        <!-- Sidebar bên trái -->
        <div class="col-md-3">
            <div class="sidebar">
                <ul class="side-menu top list-unstyled">
                    <div class="row g-2" id="user-sidebar">
                        <div class="col-12">
                            <a href="/user/profile" class="list-group-item list-group-item-action rounded-3 d-flex align-items-center  w-100 " style="
                            font-size: 15px;
                            letter-spacing: -1px;
                            font-weight: 600;
                        ">
                                <i class="fas fa-user"></i> Thông tin tài khoản
                            </a>
                        </div>
                        <div class="col-12">
                            <a href="/user/orders" class="list-group-item list-group-item-action rounded-3 d-flex align-items-center w-100" style="
                            font-size: 15px;
                            letter-spacing: -1px;
                            font-weight: 600;
                        ">
                                <i class="fas fa-shopping-bag"></i> Lịch sử đơn hàng
                            </a>
                        </div>
                        <div class="col-12">
                            <a href="/user/vouchers" class="list-group-item list-group-item-action rounded-3 d-flex align-items-center w-100 text-white bg-dark" style="
                            font-size: 15px;
                            letter-spacing: -1px;
                            font-weight: 600;
                        ">
                                <i class="fas fa-gift"></i> Ví Voucher
                            </a>
                        </div>
                        <div class="col-12">
                            <a href="/user/address" class="list-group-item list-group-item-action rounded-3 d-flex align-items-center w-100" style="
                            font-size: 15px;
                            letter-spacing: -1px;
                            font-weight: 600;
                        ">
                                <i class="fas fa-map-marker-alt"></i> Sổ địa chỉ
                            </a>
                        </div>
                        <div class="col-12">
                            <a href="/user/reviews" class="list-group-item list-group-item-action rounded-3 d-flex align-items-center w-100" style="
                            font-size: 15px;
                            letter-spacing: -1px;
                            font-weight: 600;
                        ">
                                <i class="fas fa-star"></i> Đánh giá & Phản hồi
                            </a>
                        </div>
                        <div class="col-12">
                            <a href="/user/policies" class="list-group-item list-group-item-action rounded-3 d-flex align-items-center w-100" style="
                            font-size: 15px;
                            letter-spacing: -1px;
                            font-weight: 600;
                        ">
                                <i class="fas fa-question-circle"></i> Chính sách & Câu hỏi thường gặp
                            </a>
                        </div>
                        <div class="col-12">
                            <a href="/auth/logout" class="list-group-item list-group-item-action text-danger rounded-3 d-flex align-items-center w-100" style="
                            font-size: 15px;
                            letter-spacing: -1px;
                            font-weight: 600;
                        ">
                                <i class="fas fa-sign-out-alt"></i> Đăng xuất
                            </a>
                        </div>
                    </div>
                </ul>
            </div>
        </div>

        <!-- Nội dung chính bên phải -->
        <div class="col-md-9">
            <!-- Voucher được đặt trong khung giống khung của sidebar -->
            <div class="container" style="
            background: #d9d9d9;
            padding: 20px 40px;
            margin-bottom: 30px;
            border-radius: 10px;
            min-height: 442px;
        ">
                <h2 style="
                padding-top: 10px;
                margin-bottom: 20px;
            ">Ví voucher</h2>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="voucher-card p-3">
                            <h5 class="fw-bold" style="
                            font-size: 16px;
                        ">CM10</h5>
                            <p style="
                            font-size: 12px;
                            font-weight: 600;
                        ">Giảm 10% đơn từ 600K (giảm tối đa 100K, trừ Outlet, Mix & Match)</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <p class="text-muted fst-italic" style="
                            font-size: 12px;
                            font-weight: 600;
                            margin-bottom: 5px;
                        ">HSD: 31.03.2025</p>
                            <a href="#" class=" text-decoration-none fw-medium" style="color: #273ccd;">Điều kiện</a>                            
                        </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="voucher-card p-3">
                            <h5 class="fw-bold" style="
                            font-size: 16px;
                        ">CM10</h5>
                            <p style="
                            font-size: 12px;
                            font-weight: 600;
                        ">Giảm 10% đơn từ 600K (giảm tối đa 100K, trừ Outlet, Mix & Match)</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <p class="text-muted fst-italic" style="
                            font-size: 12px;
                            font-weight: 600;
                            margin-bottom: 5px;
                        ">HSD: 31.03.2025</p>
                            <a href="#" class=" text-decoration-none fw-medium" style="color: #273ccd;">Điều kiện</a>                            
                        </div>
                        </div>
                    </div>
                    
                    
                </div>
        
                <!-- Banner -->
                <div class="mt-4 position-relative">
                    <div class="position-relative overflow-hidden text-white rounded">
                        <img src="https://mcdn.coolmate.me/image/September2023/mceclip0_96.jpg" class="img-fluid w-100 h-100 object-fit-cover" alt="Khuyến mãi">
                        <div class="position-absolute top-50 start-0 translate-middle-y text-start ps-5">
                            <h2 class="text-dark">Nhiều ưu đãi hấp dẫn<br>đang chờ bạn</h2>
                            <a href="#" class="btn btn-dark mt-3 px-4 py-2">KHÁM PHÁ NGAY →</a>
                        </div>
                    </div>
                </div>
                
                
            </div>
            
        </div>
    </div>
</div>

<!-- FontAwesome icons -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", async function () {
        const userId = 'user-id'; // Thay thế bằng ID người dùng thực tế

        // Hàm để gọi API lấy danh sách voucher
        async function fetchVouchers() {
            try {
                const response = await fetch(`/api/vouchers`);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const vouchers = await response.json();
                displayVouchers(vouchers);
            } catch (error) {
                console.error('Error fetching vouchers:', error);
            }
        }

        // Hàm để hiển thị danh sách voucher
        function displayVouchers(vouchers) {
            const voucherContainer = document.querySelector('.row.g-3');
            voucherContainer.innerHTML = ''; // Xóa nội dung cũ

            vouchers.forEach(voucher => {
                const voucherCard = document.createElement('div');
                voucherCard.className = 'col-md-4';
                voucherCard.innerHTML = `
                    <div class="voucher-card p-3">
                        <h5 class="fw-bold" style="font-size: 16px;">${voucher.code}</h5>
                        <p style="font-size: 12px; font-weight: 600;">Giảm ${voucher.discount}${voucher.type === 'percentage' ? '%' : 'đ'} đơn từ ${voucher.minOrderValue.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}
 (giảm tối đa ${voucher.maxDiscount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' })}
đ)</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <p class="text-muted fst-italic" style="font-size: 12px; font-weight: 600; margin-bottom: 5px;">HSD: ${new Date(voucher.expirationDate).toLocaleDateString()}</p>
                            <a href="#" class="text-decoration-none fw-medium" style="color: #273ccd;">Điều kiện</a>
                        </div>
                    </div>
                `;
                voucherContainer.appendChild(voucherCard);
            });
        }

        // Gọi hàm fetchVouchers khi trang được tải
        fetchVouchers();
    });
</script>