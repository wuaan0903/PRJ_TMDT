<%- layout('layouts/index') %>

<style>
    .product-image {
        max-height: 700px;
        object-fit: cover;
    }

    .thumbnail-img {
        height: 80px;
        cursor: pointer;
    }

    .thumbnail-img:hover {
        border: 2px solid #000;
    }

    @media (max-width: 576px) {
        .product-image {
            max-height: 400px;
        }
        .thumbnail-img {
            height: 60px;
        }
    }

    .cool-cash {
        background: red;
        color: white;
        font-size: 12px;
        padding: 3px 6px;
        position: absolute;
        top: 10px;
        left: 10px;
        font-weight: bold;
    }

    .color-options span {
        width: 20px;
        height: 20px;
        display: inline-block;
        border-radius: 50%;
        margin-right: 5px;
        border: 1px solid #ccc;
    }
</style>

<section style="padding-top: 80px;">
    <div class="container">
        <!-- Tiêu đề và thanh tìm kiếm -->
        <div class="d-flex align-items-center gap-3 mt-4">
            <h5 class="fw-bold mb-0">Sản phẩm</h5>
            <div class="d-flex gap-2">
                <input id="searchInput" type="text" class="form-control form-control-sm rounded-pill" placeholder="Nhập từ khóa..." style="max-width: 200px;">
                <select id="categorySelect" class="form-select form-select-sm rounded-pill" style="max-width: 200px;">
                    <option value="">Danh mục</option>
                </select>
                <button id="searchBtn" class="btn btn-dark btn-sm rounded-pill px-3">
                    <i class='bx bx-search-alt fs-4'></i>
                </button>
            </div>
        </div>
    </div>
    <hr class="my-4">
</section>

<section style="padding-bottom: 30px;">
    <div class="container">
        <!-- Tiêu đề Kết quả -->
        <h5 class="mt-4 fw-bold text-center pb-2 border-bottom">Kết quả</h5>

        <!-- Danh sách sản phẩm -->
        <div id="resultContainer" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-3"></div>
    </div>
</section>

<script>
    document.getElementById('searchBtn').addEventListener('click', searchProducts);
    document.getElementById('searchInput').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') searchProducts();
    });

    async function searchProducts() {
        const query = document.getElementById('searchInput').value.trim();
        if (!query) {
            alert('Vui lòng nhập từ khóa tìm kiếm!');
            return;
        }

        try {
            const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
            const products = await response.json();

            const resultContainer = document.getElementById('resultContainer');
            resultContainer.innerHTML = '';

            if (products.length === 0) {
                resultContainer.innerHTML = `<p class="text-center text-muted">Không tìm thấy sản phẩm nào!</p>`;
                return;
            }

            products.forEach(product => {
                const productCard = `
                    <div class="col">
                        <div class="card product-card position-relative">
                            <img src="${product.image || 'https://via.placeholder.com/300'}" class="card-img-top product-image" alt="${product.name}">
                            <div class="card-body text-center">
                                <h6 class="card-title fw-bold">${product.name}</h6>
                                <div class="color-options mt-2">
                                    ${product.colors.map(color => `<span style="background-color: ${color};"></span>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                resultContainer.innerHTML += productCard;
            });
        } catch (error) {
            console.error('Lỗi khi tìm kiếm sản phẩm:', error);
        }
    }
</script>
